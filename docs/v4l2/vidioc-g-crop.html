<?xml version="1.0" encoding="ANSI_X3.4-1968" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=ANSI_X3.4-1968" /><title>ioctl VIDIOC_G_CROP, VIDIOC_S_CROP</title><meta name="generator" content="DocBook XSL Stylesheets V1.75.2" /><link rel="home" href="index.html" title="LINUX MEDIA INFRASTRUCTURE API" /><link rel="up" href="user-func.html" title="Appendix&#160;A.&#160;Function Reference" /><link rel="prev" href="vidioc-g-audioout.html" title="ioctl VIDIOC_G_AUDOUT, VIDIOC_S_AUDOUT" /><link rel="next" href="vidioc-g-ctrl.html" title="ioctl VIDIOC_G_CTRL, VIDIOC_S_CTRL" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">ioctl VIDIOC_G_CROP, VIDIOC_S_CROP</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="vidioc-g-audioout.html">Prev</a>&#160;</td><th width="60%" align="center">Appendix&#160;A.&#160;Function Reference</th><td width="20%" align="right">&#160;<a accesskey="n" href="vidioc-g-ctrl.html">Next</a></td></tr></table><hr /></div><div class="refentry" title="ioctl VIDIOC_G_CROP, VIDIOC_S_CROP"><a id="vidioc-g-crop"></a><div class="titlepage"></div><div class="refnamediv"><h2>Name</h2><p>VIDIOC_G_CROP, VIDIOC_S_CROP &#8212; Get or set the current cropping rectangle</p></div><div class="refsynopsisdiv" title="Synopsis"><h2>Synopsis</h2><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">int <b class="fsfunc">ioctl</b>(</code></td><td>int <var class="pdparam">fd</var>, </td></tr><tr><td>&#160;</td><td>int <var class="pdparam">request</var>, </td></tr><tr><td>&#160;</td><td>struct v4l2_crop *<var class="pdparam">argp</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer">&#160;</div></div><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">int <b class="fsfunc">ioctl</b>(</code></td><td>int <var class="pdparam">fd</var>, </td></tr><tr><td>&#160;</td><td>int <var class="pdparam">request</var>, </td></tr><tr><td>&#160;</td><td>const struct v4l2_crop *<var class="pdparam">argp</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer">&#160;</div></div></div><div class="refsect1" title="Arguments"><a id="idp33755288"></a><h2>Arguments</h2><div class="variablelist"><dl><dt><span class="term"><em class="parameter"><code>fd</code></em></span></dt><dd><p>File descriptor returned by <a class="link" href="func-open.html" title="V4L2 open()"><code class="function">open()</code></a>.</p></dd><dt><span class="term"><em class="parameter"><code>request</code></em></span></dt><dd><p>VIDIOC_G_CROP, VIDIOC_S_CROP</p></dd><dt><span class="term"><em class="parameter"><code>argp</code></em></span></dt><dd><p></p></dd></dl></div></div><div class="refsect1" title="Description"><a id="idp33759392"></a><h2>Description</h2><p>To query the cropping rectangle size and position
applications set the <em class="structfield"><code>type</code></em> field of a
<span class="structname">v4l2_crop</span> structure to the respective buffer
(stream) type and call the <code class="constant">VIDIOC_G_CROP</code> ioctl
with a pointer to this structure. The driver fills the rest of the
structure or returns the <span class="errorcode">EINVAL</span> error code if cropping is not supported.</p><p>To change the cropping rectangle applications initialize the
<em class="structfield"><code>type</code></em> and struct&#160;<a class="link" href="overlay.html#v4l2-rect" title="Table&#160;4.3.&#160;struct v4l2_rect">v4l2_rect</a> substructure named
<em class="structfield"><code>c</code></em> of a v4l2_crop structure and call the
<code class="constant">VIDIOC_S_CROP</code> ioctl with a pointer to this
structure.</p><p>The driver first adjusts the requested dimensions against
hardware limits, i.&#160;e. the bounds given by the capture/output window,
and it rounds to the closest possible values of horizontal and
vertical offset, width and height. In particular the driver must round
the vertical offset of the cropping rectangle to frame lines modulo
two, such that the field order cannot be confused.</p><p>Second the driver adjusts the image size (the opposite
rectangle of the scaling process, source or target depending on the
data direction) to the closest size possible while maintaining the
current horizontal and vertical scaling factor.</p><p>Finally the driver programs the hardware with the actual
cropping and image parameters. <code class="constant">VIDIOC_S_CROP</code> is a
write-only ioctl, it does not return the actual parameters. To query
them applications must call <code class="constant">VIDIOC_G_CROP</code> and
<a class="link" href="vidioc-g-fmt.html" title="ioctl VIDIOC_G_FMT, VIDIOC_S_FMT, VIDIOC_TRY_FMT"><code class="constant">VIDIOC_G_FMT</code></a>. When the parameters are unsuitable the application may
modify the cropping or image parameters and repeat the cycle until
satisfactory parameters have been negotiated.</p><p>When cropping is not supported then no parameters are
changed and <code class="constant">VIDIOC_S_CROP</code> returns the
<span class="errorcode">EINVAL</span> error code.</p><div class="table"><a id="v4l2-crop"></a><p class="title"><b>Table&#160;A.51.&#160;struct <span class="structname">v4l2_crop</span></b></p><div class="table-contents"><table summary="struct v4l2_crop" width="100%" border="0"><colgroup><col /><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">__u32</td><td valign="top"><em class="structfield"><code>type</code></em></td><td valign="top">Type of the data stream, set by the application.
Only these types are valid here: <code class="constant">V4L2_BUF_TYPE_VIDEO_CAPTURE</code>,
<code class="constant">V4L2_BUF_TYPE_VIDEO_OUTPUT</code> and
<code class="constant">V4L2_BUF_TYPE_VIDEO_OVERLAY</code>. See <a class="xref" href="buffer.html#v4l2-buf-type" title="Table&#160;3.3.&#160;enum v4l2_buf_type">Table&#160;3.3, &#8220;enum v4l2_buf_type&#8221;</a>.</td></tr><tr><td valign="top">struct&#160;<a class="link" href="overlay.html#v4l2-rect" title="Table&#160;4.3.&#160;struct v4l2_rect">v4l2_rect</a></td><td valign="top"><em class="structfield"><code>c</code></em></td><td valign="top">Cropping rectangle. The same co-ordinate system as
for struct&#160;<a class="link" href="vidioc-cropcap.html#v4l2-cropcap" title="Table&#160;A.2.&#160;struct v4l2_cropcap">v4l2_cropcap</a> <em class="structfield"><code>bounds</code></em> is used.</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="refsect1" title="Return Value"><a id="idp33773256"></a><h2>Return Value</h2><p>On success <span class="returnvalue">0</span> is returned, on error <span class="returnvalue">-1</span> and the <code class="varname">errno</code> variable is set appropriately. The generic error codes are described at the <a class="link" href="gen_errors.html#gen-errors" title="Table&#160;19.1.&#160;Generic error codes">Generic Error Codes</a> chapter.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="vidioc-g-audioout.html">Prev</a>&#160;</td><td width="20%" align="center"><a accesskey="u" href="user-func.html">Up</a></td><td width="40%" align="right">&#160;<a accesskey="n" href="vidioc-g-ctrl.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">ioctl VIDIOC_G_AUDOUT, VIDIOC_S_AUDOUT&#160;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&#160;ioctl VIDIOC_G_CTRL, VIDIOC_S_CTRL</td></tr></table></div></body></html>
