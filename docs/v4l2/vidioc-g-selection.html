<?xml version="1.0" encoding="ANSI_X3.4-1968" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=ANSI_X3.4-1968" /><title>ioctl VIDIOC_G_SELECTION, VIDIOC_S_SELECTION</title><meta name="generator" content="DocBook XSL Stylesheets V1.75.2" /><link rel="home" href="index.html" title="LINUX MEDIA INFRASTRUCTURE API" /><link rel="up" href="user-func.html" title="Appendix&#160;A.&#160;Function Reference" /><link rel="prev" href="vidioc-g-priority.html" title="ioctl VIDIOC_G_PRIORITY, VIDIOC_S_PRIORITY" /><link rel="next" href="vidioc-g-sliced-vbi-cap.html" title="ioctl VIDIOC_G_SLICED_VBI_CAP" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">ioctl VIDIOC_G_SELECTION, VIDIOC_S_SELECTION</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="vidioc-g-priority.html">Prev</a>&#160;</td><th width="60%" align="center">Appendix&#160;A.&#160;Function Reference</th><td width="20%" align="right">&#160;<a accesskey="n" href="vidioc-g-sliced-vbi-cap.html">Next</a></td></tr></table><hr /></div><div class="refentry" title="ioctl VIDIOC_G_SELECTION, VIDIOC_S_SELECTION"><a id="vidioc-g-selection"></a><div class="titlepage"></div><div class="refnamediv"><h2>Name</h2><p>VIDIOC_G_SELECTION, VIDIOC_S_SELECTION &#8212; Get or set one of the selection rectangles</p></div><div class="refsynopsisdiv" title="Synopsis"><h2>Synopsis</h2><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">int <b class="fsfunc">ioctl</b>(</code></td><td>int <var class="pdparam">fd</var>, </td></tr><tr><td>&#160;</td><td>int <var class="pdparam">request</var>, </td></tr><tr><td>&#160;</td><td>struct v4l2_selection *<var class="pdparam">argp</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer">&#160;</div></div></div><div class="refsect1" title="Arguments"><a id="idp34922616"></a><h2>Arguments</h2><div class="variablelist"><dl><dt><span class="term"><em class="parameter"><code>fd</code></em></span></dt><dd><p>File descriptor returned by <a class="link" href="func-open.html" title="V4L2 open()"><code class="function">open()</code></a>.</p></dd><dt><span class="term"><em class="parameter"><code>request</code></em></span></dt><dd><p>VIDIOC_G_SELECTION, VIDIOC_S_SELECTION</p></dd><dt><span class="term"><em class="parameter"><code>argp</code></em></span></dt><dd><p></p></dd></dl></div></div><div class="refsect1" title="Description"><a id="idp34994008"></a><h2>Description</h2><div class="note" title="Experimental" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Experimental</h3><p>This is an <a class="link" href="hist-v4l2.html#experimental" title="Experimental API Elements"> experimental </a>
      interface and may change in the future.</p></div><p>The ioctls are used to query and configure selection rectangles.</p><p> To query the cropping (composing) rectangle set struct&#160;<a class="link" href="vidioc-g-selection.html#v4l2-selection" title="Table&#160;A.79.&#160;struct v4l2_selection">v4l2_selection</a>
<em class="structfield"><code> type </code></em> field to the respective buffer type.
Do not use multiplanar buffers.  Use <code class="constant"> V4L2_BUF_TYPE_VIDEO_CAPTURE
</code> instead of <code class="constant"> V4L2_BUF_TYPE_VIDEO_CAPTURE_MPLANE
</code>.  Use <code class="constant"> V4L2_BUF_TYPE_VIDEO_OUTPUT </code> instead of
<code class="constant"> V4L2_BUF_TYPE_VIDEO_OUTPUT_MPLANE </code>.  The next step is
setting the value of struct&#160;<a class="link" href="vidioc-g-selection.html#v4l2-selection" title="Table&#160;A.79.&#160;struct v4l2_selection">v4l2_selection</a> <em class="structfield"><code>target</code></em> field
to <code class="constant"> V4L2_SEL_TGT_CROP </code> (<code class="constant">
V4L2_SEL_TGT_COMPOSE </code>).  Please refer to table <a class="xref" href="apb.html#v4l2-selections-common" title="Common selection definitions">the section called &#8220;Common selection definitions&#8221;</a> or <a class="xref" href="selection-api.html" title="Experimental API for cropping, composing and scaling">the section called &#8220;Experimental API for cropping, composing and scaling&#8221;</a> for additional
targets.  The <em class="structfield"><code>flags</code></em> and <em class="structfield"><code>reserved
</code></em> fields of struct&#160;<a class="link" href="vidioc-g-selection.html#v4l2-selection" title="Table&#160;A.79.&#160;struct v4l2_selection">v4l2_selection</a> are ignored and they must be filled
with zeros.  The driver fills the rest of the structure or
returns <span class="errorcode">EINVAL</span> error code if incorrect buffer type or target was used. If cropping
(composing) is not supported then the active rectangle is not mutable and it is
always equal to the bounds rectangle.  Finally, the struct&#160;<a class="link" href="overlay.html#v4l2-rect" title="Table&#160;4.3.&#160;struct v4l2_rect">v4l2_rect</a>
<em class="structfield"><code>r</code></em> rectangle is filled with the current cropping
(composing) coordinates. The coordinates are expressed in driver-dependent
units. The only exception are rectangles for images in raw formats, whose
coordinates are always expressed in pixels.  </p><p> To change the cropping (composing) rectangle set the struct&#160;<a class="link" href="vidioc-g-selection.html#v4l2-selection" title="Table&#160;A.79.&#160;struct v4l2_selection">v4l2_selection</a>
<em class="structfield"><code>type</code></em> field to the respective buffer type.  Do not
use multiplanar buffers.  Use <code class="constant"> V4L2_BUF_TYPE_VIDEO_CAPTURE
</code> instead of <code class="constant"> V4L2_BUF_TYPE_VIDEO_CAPTURE_MPLANE
</code>.  Use <code class="constant"> V4L2_BUF_TYPE_VIDEO_OUTPUT </code> instead of
<code class="constant"> V4L2_BUF_TYPE_VIDEO_OUTPUT_MPLANE </code>.  The next step is
setting the value of struct&#160;<a class="link" href="vidioc-g-selection.html#v4l2-selection" title="Table&#160;A.79.&#160;struct v4l2_selection">v4l2_selection</a> <em class="structfield"><code>target</code></em> to
<code class="constant">V4L2_SEL_TGT_CROP</code> (<code class="constant">
V4L2_SEL_TGT_COMPOSE </code>). Please refer to table <a class="xref" href="apb.html#v4l2-selections-common" title="Common selection definitions">the section called &#8220;Common selection definitions&#8221;</a> or <a class="xref" href="selection-api.html" title="Experimental API for cropping, composing and scaling">the section called &#8220;Experimental API for cropping, composing and scaling&#8221;</a> for additional
targets.  The struct&#160;<a class="link" href="overlay.html#v4l2-rect" title="Table&#160;4.3.&#160;struct v4l2_rect">v4l2_rect</a> <em class="structfield"><code>r</code></em> rectangle need to be
set to the desired active area. Field struct&#160;<a class="link" href="vidioc-g-selection.html#v4l2-selection" title="Table&#160;A.79.&#160;struct v4l2_selection">v4l2_selection</a> <em class="structfield"><code> reserved
</code></em> is ignored and must be filled with zeros.  The driver may adjust
coordinates of the requested rectangle. An application may
introduce constraints to control rounding behaviour. The struct&#160;<a class="link" href="vidioc-g-selection.html#v4l2-selection" title="Table&#160;A.79.&#160;struct v4l2_selection">v4l2_selection</a>
<em class="structfield"><code>flags</code></em> field must be set to one of the following:

</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="constant">0</code> - The driver can adjust the rectangle size freely
and shall choose a crop/compose rectangle as close as possible to the requested
one.</p></li><li class="listitem"><p><code class="constant">V4L2_SEL_FLAG_GE</code> - The driver is not allowed to
shrink the rectangle.  The original rectangle must lay inside the adjusted
one.</p></li><li class="listitem"><p><code class="constant">V4L2_SEL_FLAG_LE</code> - The driver is not allowed to
enlarge the rectangle.  The adjusted rectangle must lay inside the original
one.</p></li><li class="listitem"><p><code class="constant">V4L2_SEL_FLAG_GE | V4L2_SEL_FLAG_LE</code> - The driver
must choose the size exactly the same as in the requested rectangle.</p></li></ul></div><p>

Please refer to <a class="xref" href="vidioc-g-selection.html#sel-const-adjust" title="Figure&#160;A.1.&#160;Size adjustments with constraint flags.">Figure&#160;A.1, &#8220;Size adjustments with constraint flags.&#8221;</a>.

</p><p> The driver may have to adjusts the requested dimensions against hardware
limits and other parts as the pipeline, i.e. the bounds given by the
capture/output window or TV display. The closest possible values of horizontal
and vertical offset and sizes are chosen according to following priority:

</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Satisfy constraints from struct&#160;<a class="link" href="vidioc-g-selection.html#v4l2-selection" title="Table&#160;A.79.&#160;struct v4l2_selection">v4l2_selection</a> <em class="structfield"><code>flags</code></em>.</p></li><li class="listitem"><p>Adjust width, height, left, and top to hardware limits and alignments.</p></li><li class="listitem"><p>Keep center of adjusted rectangle as close as possible to the original one.</p></li><li class="listitem"><p>Keep width and height as close as possible to original ones.</p></li><li class="listitem"><p>Keep horizontal and vertical offset as close as possible to original ones.</p></li></ol></div><p>

On success the struct&#160;<a class="link" href="overlay.html#v4l2-rect" title="Table&#160;4.3.&#160;struct v4l2_rect">v4l2_rect</a> <em class="structfield"><code>r</code></em> field contains
the adjusted rectangle. When the parameters are unsuitable the application may
modify the cropping (composing) or image parameters and repeat the cycle until
satisfactory parameters have been negotiated. If constraints flags have to be
violated at then ERANGE is returned. The error indicates that <span class="emphasis"><em> there
exist no rectangle </em></span> that satisfies the constraints.</p><p>Selection targets and flags are documented in <a class="xref" href="apb.html#v4l2-selections-common" title="Common selection definitions">the section called &#8220;Common selection definitions&#8221;</a>.</p><p>
      </p><div class="figure"><a id="sel-const-adjust"></a><p class="title"><b>Figure&#160;A.1.&#160;Size adjustments with constraint flags.</b></p><div class="figure-contents"><div class="mediaobject"><img src="constraints.png" alt="Behaviour of rectangle adjustment for different constraint flags." /></div></div></div><p><br class="figure-break" />
    </p><p>
    </p><div class="table"><a id="v4l2-selection"></a><p class="title"><b>Table&#160;A.79.&#160;struct <span class="structname">v4l2_selection</span></b></p><div class="table-contents"><table summary="struct v4l2_selection" width="100%" border="0"><colgroup><col /><col /><col /></colgroup><tbody valign="top"><tr><td valign="top">__u32</td><td valign="top"><em class="structfield"><code>type</code></em></td><td valign="top">Type of the buffer (from enum&#160;<a class="link" href="buffer.html#v4l2-buf-type" title="Table&#160;3.3.&#160;enum v4l2_buf_type">v4l2_buf_type</a>).</td></tr><tr><td valign="top">__u32</td><td valign="top"><em class="structfield"><code>target</code></em></td><td valign="top">Used to select between <a class="link" href="apb.html#v4l2-selections-common" title="Common selection definitions"> cropping
	    and composing rectangles</a>.</td></tr><tr><td valign="top">__u32</td><td valign="top"><em class="structfield"><code>flags</code></em></td><td valign="top">Flags controlling the selection rectangle adjustments, refer to
	    <a class="link" href="apb.html#v4l2-selection-flags" title="Selection flags">selection flags</a>.</td></tr><tr><td valign="top">struct&#160;<a class="link" href="overlay.html#v4l2-rect" title="Table&#160;4.3.&#160;struct v4l2_rect">v4l2_rect</a></td><td valign="top"><em class="structfield"><code>r</code></em></td><td valign="top">The selection rectangle.</td></tr><tr><td valign="top">__u32</td><td valign="top"><em class="structfield"><code>reserved[9]</code></em></td><td valign="top">Reserved fields for future use.</td></tr></tbody></table></div></div><p><br class="table-break" />
  </p></div><div class="refsect1" title="Return Value"><a id="idp35029080"></a><h2>Return Value</h2><p>On success <span class="returnvalue">0</span> is returned, on error <span class="returnvalue">-1</span> and the <code class="varname">errno</code> variable is set appropriately. The generic error codes are described at the <a class="link" href="gen_errors.html#gen-errors" title="Table&#160;19.1.&#160;Generic error codes">Generic Error Codes</a> chapter.</p><div class="variablelist"><dl><dt><span class="term"><span class="errorcode">EINVAL</span></span></dt><dd><p>Given buffer type <em class="structfield"><code>type</code></em> or
the selection target <em class="structfield"><code>target</code></em> is not supported,
or the <em class="structfield"><code>flags</code></em> argument is not valid.</p></dd><dt><span class="term"><span class="errorcode">ERANGE</span></span></dt><dd><p>It is not possible to adjust struct&#160;<a class="link" href="overlay.html#v4l2-rect" title="Table&#160;4.3.&#160;struct v4l2_rect">v4l2_rect</a> <em class="structfield"><code>
r</code></em> rectangle to satisfy all contraints given in the
<em class="structfield"><code>flags</code></em> argument.</p></dd><dt><span class="term"><span class="errorcode">EBUSY</span></span></dt><dd><p>It is not possible to apply change of the selection rectangle
at the moment. Usually because streaming is in progress.</p></dd></dl></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="vidioc-g-priority.html">Prev</a>&#160;</td><td width="20%" align="center"><a accesskey="u" href="user-func.html">Up</a></td><td width="40%" align="right">&#160;<a accesskey="n" href="vidioc-g-sliced-vbi-cap.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">ioctl VIDIOC_G_PRIORITY, VIDIOC_S_PRIORITY&#160;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&#160;ioctl VIDIOC_G_SLICED_VBI_CAP</td></tr></table></div></body></html>
